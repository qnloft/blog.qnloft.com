---
title: N100 主机黑群晖踩坑记 - 持续更新
published: 2024-07-29
description: 黑群晖安装指南，黑群晖安装经验分享，以及注意事项。
image: ""
tags: [N100, 黑群晖]
category: NAS系统
draft: false
pinned: 1
customSlug: yZh8lPar
---

## 机器黑群晖前硬件清单

1. 内存配置，推荐4G+（**必须**）；
2. SSD硬盘一块或者SATA硬盘一块，大小看个人需求（**必须**）；
3. M.2硬盘一块，大小看个人需求（非必须）；
4. 引导盘，U盘或者SD卡都可，大小8G+（**必须**）；

## 镜像下载

**中文镜像下载地址**：[github下载链接](https://github.com/RROrg/rr/releases)

## 黑群辉安装型号选择


> 根据Synology官网，**部分机型具有用于安装 M.2 SSD 的内置插槽**，支持 M.2 NVMe SSD （固态硬盘）支持创建存储池 

Synology NAS型号如下 ：  
- **23 系列**  
	DS1823xs+、DS923+、DS723+、DS423+  
- **22 系列1**  
	DS1522+  
- **21 系列1**  
	DS1821+、DS1621xs+、DS1621+


## M.2 硬盘的挂载

如果想让m.2硬盘正常建立存储池，必须执行下面的命令：

```shell
# 切换root账户
sudo -i

# 查看SSD硬盘状态
ls /dev/nvme*

# 查看磁盘信息
fdisk -l /dev/nvme0n1

# 创建分区
synopartition --part /dev/nvme0n1 12

# 查看创建的分区布局
fdisk -l /dev/nvme0n1

# 查看当前Raid设置
cat /proc/mdstat

# 创建你自己的NVME Basic创建阵列
# 这里注意 md3 是上一步中 `mdstat` 的结果中顺延一位
mdadm --create /dev/md3 --level=1 --raid-devices=1 --force /dev/nvme0n1p3

# 创建filesystem 储存空间
# 上一步是 md3 这里也是，上一步是几，这里就是几
mkfs.ext4 -F /dev/md3

# 创建btrfs格式（好像在这上面可以使用虚拟机的储存）
mkfs.btrfs -f /dev/md3

# 重启
reboot
```

执行命令的方式：

第一步：打开黑群晖SSH通道；
第二步：使用SSH工具，例如XShell等连接；

## 关于黑群晖洗白：

> 群晖系统存在三种状态：黑群晖（没洗白）、半洗白和全洗白；
> **其实黑群晖没必要洗，因为那几款软件都有更好的替代产品，关注我，给你更多惊喜！**

1. 没洗白：

    - 不能注册和登录QuickConnect，无法进行内网穿透；
    - DS Photo/Moments套件的预览图是黑的；
    - DS Video在观看时只能选择原码，不能切换码率，无法离线转码。
        
2. 半洗白：
    
    - DS Photo/Moments预览图正常；
    - DS Video的视频质量可以自由切换，支持离线转码；
    - 不能注册和登录QuickConnect。
        
3. 全洗白：
    
    - 以上限制全部解除，包括登录QuickConnect。 请注意：洗白存在版权问题，还可能会导致封号，不建议洗全白。

## 关于应用的安装

#### 方式一

> 添加矿神套件数据源，基本常用套件都有了，简单方便，适合新手

![Pasted image 20240420004058](https://oss.qnloft.com/ob-img/2024/04/20/Pasted%20image%2020240420004058.png)

#### 方式二

> 在 **套件中心** 安装 `Container Manager`，之后在这里安装和管理Docker镜像。这种方式可以进行很多细节的设置，但是对新手有一定的学习曲线。

![Pasted image 20240420004434](https://oss.qnloft.com/ob-img/2024/04/20/Pasted%20image%2020240420004434.png)


## 其他问题

#### 找不到硬盘

![Pasted image 20240419234133](https://oss.qnloft.com/ob-img/2024/04/20/Pasted%20image%2020240419234133.png)

> 问题原因：可能是没有SATA硬盘，群辉不支持单独M.2硬盘。加装一个SATA硬盘即可

#### 套件中心无法连接网络，更换数据源也不行

> 问题原因：证书过期

在SSH中，执行一下命令

```shell

sudo mv /etc/ssl/certs/ca-certificates.crt /etc/ssl/certs/ca-certificates.crt.bak && sudo curl -Lko /etc/ssl/certs/ca-certificates.crt https://curl.se/ca/cacert.pem
```

## SSH 莫名其妙无法外网访问

#### 我狠起来自己都搞
> 问题描述：某一天突然发现SSH突然无法在公网访问了，找遍了，最后发现原因居然在这里！

![Pasted image 20240616121459](https://oss.qnloft.com/ob-img/2024/06/16/Pasted%20image%2020240616121459.png)
![Pasted image 20240616121552](https://oss.qnloft.com/ob-img/2024/06/16/Pasted%20image%2020240616121552.png)

如果图（2）出，黑名单里面有数据，删掉即可

## SSH 切换 `Root` 权限账户

执行命令

```shell
sudo -i
```

之后输入管理员密码即可

## Docker 相关

群晖 container manager 无法执行此操作

```shell
# 重启Docker服务
sudo synosystemctl restart pkgctl-ContainerManager

# 确认服务已重启
sudo synosystemctl status pkgctl-ContainerManager

# 看一下自己机器现在所用的镜像地址；
sudo docker info 2>/dev/null | grep "Registry" 

# 查看一下docker配置
sudo docker info
```

## 飞牛 虚拟机安装 黑群晖

参考：
- 这个管用，非常好：https://club.fnnas.com/forum.php?mod=viewthread&tid=12910&highlight=
- 这个磁盘挂载地方有问题：https://geekxw.top/2410/
- 这个是介绍镜像启动后的安装：https://www.bilibili.com/video/av113599217409079/?vd_source=a260ca45aa372006cbdbe3e2d5be5c2d
```shell
# 教程中的 网盘文件，使用这个命令生成
qemu-img convert -O qcow2 rr.img op.qcow2
```

